#ifndef PARTICLE_H
#define PARTICLE_H
#if defined (__linux__) || defined (WIN32)
#include <GL/gl.h>
#include <GL/glu.h>
#else
#include <OpenGL/gl.h>
#include <OpenGL/glu.h>
#endif
#include "glm/gtc/type_ptr.hpp"
#include <random>
#include <chrono>
#include <glm/glm.hpp>
#include <memory>
#include <cmath>
#include <glm/gtc/random.hpp>
#include <glm/gtx/polar_coordinates.hpp>

class Particle
{
public:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Flag telling us if the particle is currently alive
  //----------------------------------------------------------------------------------------------------------------------
  bool m_alive = true;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Flag for whether or not this particle spawns children
  //----------------------------------------------------------------------------------------------------------------------
  bool m_spawn = false;

public:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Default constructor that initialises member variables to default values
  //----------------------------------------------------------------------------------------------------------------------
  Particle() = default;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Constructor using intial position, velocity, colour, size, life span and a spawn flag
  /// @param[in] _pos the initial position of the particle
  /// @param[in] _vel the initial velocity of the particle
  /// @param[in] _col the initial colour of the particle
  /// @param[in] _size the initial size of the particle
  /// @param[in] _life the initial life of the particle
  /// @param[in] _frame the current frame, used to set m_birthFrame
  /// @param[in] _spawn used to set m_spawn, flag for spawning children
  //----------------------------------------------------------------------------------------------------------------------
  Particle( glm::vec3 const&_pos,
            glm::vec3 const&_vel,
            glm::vec4 const&_col,
            float const&_size,
            int const&_life,
            int const&_frame,
            bool const&_spawn );

  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Virtual destructor for particle, neccessary to prevent memory leak
  //----------------------------------------------------------------------------------------------------------------------
  virtual ~Particle();
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Returns the amount of child particles to spawn
  /// @param[in] _frame the current frame
  //----------------------------------------------------------------------------------------------------------------------
  virtual int newParts( int const&_frame) const = 0;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Updates the particle properties
  /// @param[in] ??????????
  //----------------------------------------------------------------------------------------------------------------------
  virtual void update( int const&);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Creates a pointer to a child particle
  /// @param[in] _frame the current frame
  //----------------------------------------------------------------------------------------------------------------------
  virtual Particle* createChild( int const&_frame) const = 0;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief Draws the particle
  /// @param[in] _frame the current frame
  //----------------------------------------------------------------------------------------------------------------------
  virtual void draw( int const&_frame) const = 0;

protected:
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The position of the particle
  //----------------------------------------------------------------------------------------------------------------------
  glm::vec3      m_pos = glm::vec3(0.0f,0.0f,0.0f);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The velocity of the particle
  //----------------------------------------------------------------------------------------------------------------------
  glm::vec3      m_vel = glm::vec3(0.0f,0.0f,0.0f);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The acceleration of the particle
  //----------------------------------------------------------------------------------------------------------------------
  glm::vec3      m_accel = glm::vec3(0.0f,-0.01f,0.0f);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The colour of the particle
  //----------------------------------------------------------------------------------------------------------------------
  glm::vec4      m_col = glm::vec4(1.0f,1.0f,1.0f,1.0f);
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The rate of colour change
  //----------------------------------------------------------------------------------------------------------------------
  glm::vec4      m_colDelta;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The rate of size change
  //----------------------------------------------------------------------------------------------------------------------
  float          m_sizeDelta;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The size of the particle
  //----------------------------------------------------------------------------------------------------------------------
  float          m_size = 5.0f;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The remaining life span in frames
  //----------------------------------------------------------------------------------------------------------------------
  int            m_life = 100;
  //----------------------------------------------------------------------------------------------------------------------
  /// @brief The frame the particle was born
  //----------------------------------------------------------------------------------------------------------------------
  int            m_birthFrame;

}; // end class


#endif // PARTICLE_H
